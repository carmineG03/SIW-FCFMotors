<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Scopri i dettagli del concessionario FCF Motors e tutte le auto disponibili."/>
  <meta name="keywords" content="concessionario auto, FCF Motors, auto nuove, auto usate, dettagli concessionario"/>
  <meta name="robots" content="index, follow"/>
  <!-- Open Graph -->
  <meta property="og:title" content="Dettagli Concessionario - FCF Motors"/>
  <meta property="og:description" content="Scopri i dettagli del concessionario FCF Motors e tutte le auto disponibili."/>
  <meta property="og:image" content="https://www.fcfmotors.com/image/logo1.png"/>
  <meta property="og:url" content="https://www.fcfmotors.com/dealers"/>
  <meta property="og:type" content="website"/>
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Dettagli Concessionario - FCF Motors"/>
  <meta name="twitter:description" content="Scopri i dettagli del concessionario FCF Motors e tutte le auto disponibili."/>
  <meta name="twitter:image" content="https://www.fcfmotors.com/image/logo1.png"/>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/image/favicon.png"/>
  <!-- Preload CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="preload" href="/css/styles.css" as="style"/>
  <link rel="stylesheet" href="/css/styles.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bungee+Spice&family=Open+Sans:wght@400;600;700&display=swap"/>
  <!-- Dati strutturati -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "FCF Motors",
      "url": "https://www.fcfmotors.com",
      "logo": "https://www.fcfmotors.com/image/logo1.png",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+39-123-456-7890",
        "contactType": "customer service",
        "email": "info@fcfmotors.com",
        "areaServed": "IT"
      },
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Via Auto, 123",
        "addressLocality": "Milano",
        "addressCountry": "IT"
      }
    }
  </script>
  <title th:text="${dealer.name} + ' - FCF Motors'">Dettagli Concessionario - FCF Motors</title>
  <style>
    /* Stili per la pagina */
    body {
      background-color: #F5F6F5;
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      color: #333;
    }
    .dealer-details-section {
      padding: 40px 20px;
      max-width: 1200px;
      margin: 100px auto 0;
      background-color: #F5F6F5;
    }
    .dealer-content {
      text-align: center;
      margin-bottom: 60px;
    }
    .dealer-content h2 {
      font-family: 'Bungee Spice', sans-serif;
      font-size: 2.8rem;
      color: #F5A623;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .error-message {
      color: #D32F2F;
      font-size: 1rem;
      margin: 10px 0;
      text-align: center;
    }
    .dealer-content .main-image-container {
      width: 100%;
      max-height: 400px;
      margin-bottom: 20px;
    }
    .dealer-content .main-image-container img {
      width: 100%;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .dealer-content .thumbnails-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .dealer-content .thumbnails-container img {
      width: 120px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .dealer-content .thumbnails-container img:hover {
      transform: scale(1.05);
    }
    .dealer-content .details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .detail-item {
      background: #FFFFFF;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .detail-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .detail-item i {
      color: #F5A623;
      font-size: 1.2rem;
      margin-right: 8px;
    }
    .detail-item span, .detail-item a {
      font-size: 0.95rem;
      color: #333;
      font-weight: 600;
    }
    .detail-item a {
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .detail-item a:hover {
      color: #F5A623;
    }
    .navigate-button {
      display: inline-flex;
      align-items: center;
      margin-top: 20px;
      padding: 10px 20px;
      background: linear-gradient(45deg, #F5A623, #E59400);
      color: #FFFFFF;
      text-decoration: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .navigate-button:hover {
      background: linear-gradient(45deg, #E59400, #D68F1D);
      transform: translateY(-2px);
    }
    .navigate-button i {
      margin-right: 8px;
    }
    /* Stili per la sezione auto */
    .cars-section {
      margin-top: 40px;
    }
    .cars-section h2 {
      font-family: 'Bungee Spice', sans-serif;
      font-size: 2.2rem;
      color: #003087;
      text-align: center;
      margin-bottom: 30px;
      text-transform: uppercase;
    }
    .no-products {
      text-align: center;
      font-size: 1.1rem;
      color: #666;
      margin: 20px 0;
    }
    .car-grid {
      display: grid;
      grid-template-columns: repeat(3, 33.3%);
      gap: 25px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    @media (max-width: 1024px) {
      .car-grid {
        grid-template-columns: repeat(2, 50%);
      }
    }
    @media (max-width: 768px) {
      .car-grid {
        grid-template-columns: 1fr;
      }
    }
    .car-card {
      background: #FFFFFF;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }
    .car-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    .car-card.highlighted {
      border: 2px solid #FFD700;
    }
    .car-image {
      position: relative;
      width: 100%;
      height: 160px;
    }
    .car-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    .car-card:hover .car-image img {
      transform: scale(1.03);
    }
    .car-image .highlight-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #FFD700;
      color: #333;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .car-info {
      padding: 15px;
      text-align: center;
    }
    .car-info h4 {
      font-family: 'Open Sans', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: #003087;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .car-info .price {
      font-size: 1.2rem;
      color: #F5A623;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .car-info .details {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.4;
    }
    .car-actions {
      padding: 10px;
      text-align: center;
    }
    .car-actions .modern-button {
      background: linear-gradient(45deg, #F5A623, #E59400);
      color: #FFFFFF;
      padding: 10px 50px;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.2s ease, transform 0.2s ease;
    }
    .car-actions .modern-button:hover {
      background: linear-gradient(45deg, #E59400, #D68F1D);
      transform: translateY(-2px);
    }
    /* Stili per il popup */
    .car-details-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
    }
    .car-details-popup.show {
      display: flex;
    }
    .car-details-popup-content {
      background: #FFFFFF;
      border-radius: 12px;
      padding: 25px;
      max-width: 1000px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      animation: fadeIn 0.3s ease-in-out;
      scrollbar-width: none;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .car-details-popup-content h3 {
      font-family: 'Open Sans', sans-serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: #003087;
      margin-bottom: 15px;
      text-align: center;
    }
    .car-details-popup-content .carousel {
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }
    .car-details-popup-content .carousel-inner {
      position: relative;
      width: 100%;
      overflow: hidden;
    }
    .car-details-popup-content .carousel-item {
      display: none;
      position: relative;
      width: 100%;
    }
    .car-details-popup-content .carousel-item.active {
      display: block;
    }
    .car-details-popup-content .carousel-item img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .car-details-popup-content .carousel-thumbnails {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .car-details-popup-content .carousel-thumbnails img {
      width: 80px;
      height: 60px;
      object-fit: cover;
      margin: 0 5px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.3s ease;
    }
    .car-details-popup-content .carousel-thumbnails img.active {
      border: 2px solid #F5A623;
    }
    .car-details-popup-content .carousel-control-prev, .car-details-popup-content .carousel-control-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: #FFFFFF;
      border: none;
      padding: 10px;
      cursor: pointer;
      z-index: 1;
    }
    .car-details-popup-content .carousel-control-prev {
      left: 10px;
    }
    .car-details-popup-content .carousel-control-next {
      right: 10px;
    }
    .car-details-popup-content .detail-field {
      margin-bottom: 12px;
    }
    .car-details-popup-content .detail-field label {
      font-size: 0.9rem;
      font-weight: 600;
      color: #F5A623;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 5px;
    }
    .car-details-popup-content .detail-field label i {
      color: #003087;
    }
    .car-details-popup-content .detail-field p {
      font-size: 0.95rem;
      color: #333;
      margin: 0;
      line-height: 1.4;
    }
    .close-popup {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      color: #F5A623;
      cursor: pointer;
      transition: color 0.2s ease, transform 0.2s ease;
    }
    .close-popup:hover {
      color: #E59400;
      transform: scale(1.1);
    }
    .car-details-popup-content::-webkit-scrollbar {
      width: 5px;
    }
    .car-details-popup-content::-webkit-scrollbar-track {
      background: #F5F6F5;
      border-radius: 3px;
    }
    .car-details-popup-content::-webkit-scrollbar-thumb {
      background: #F5A623;
      border-radius: 3px;
    }
    .car-details-popup-content::-webkit-scrollbar-thumb:hover {
      background: #E59400;
    }
    /* Responsive popup */
    @media (max-width: 768px) {
      .car-details-popup-content {
        padding: 20px;
        max-width: 90%;
      }
      .car-details-popup-content h3 {
        font-size: 1.5rem;
      }
      .car-details-popup-content .detail-field label {
        font-size: 0.85rem;
      }
      .car-details-popup-content .detail-field p {
        font-size: 0.9rem;
      }
    }
    @media (max-width: 480px) {
      .car-details-popup-content {
        padding: 15px;
      }
      .car-details-popup-content h3 {
        font-size: 1.3rem;
      }
      .car-details-popup-content .detail-field label {
        font-size: 0.8rem;
      }
      .car-details-popup-content .detail-field p {
        font-size: 0.85rem;
      }
    }
    /* Responsive layout */
    @media (max-width: 1024px) {
      .car-grid {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }
      .dealer-content h2 {
        font-size: 2.5rem;
      }
      .cars-section h2 {
        font-size: 2rem;
      }
    }
    @media (max-width: 768px) {
      .car-grid {
        grid-template-columns: 1fr;
      }
      .dealer-content .details-grid {
        grid-template-columns: 1fr;
      }
      .dealer-content .main-image-container {
        max-height: 300px;
      }
      .dealer-content .thumbnails-container {
        flex-wrap: wrap;
      }
      .car-image {
        height: 140px;
      }
      .car-info h4 {
        font-size: 1.2rem;
      }
      .car-info .price {
        font-size: 1.1rem;
      }
      .car-info .details {
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>
<header id="main-header">
  <div class="header-left">
    <a href="/" class="logo-link">
      <div class="logo-container">
        <img th:src="@{/image/logo1.png}" alt="FCF Motors Logo" class="logo"/>
      </div>
    </a>
    <div class="title-container">
      <h1 class="main-title">FCF MOTORS</h1>
    </div>
  </div>
  <div class="nav-container">
    <div class="nav-bar"></div>
  </div>
  <div class="header-right">
    <div class="dropdown">
      <button class="dropdown-toggle" aria-label="Menu">
        <i class="fas fa-bars"></i>
      </button>
      <div class="dropdown-menu">
        <a th:href="@{/products}"><i class="fas fa-car"></i> Trova Auto</a>
        <a th:href="@{/dealers}"><i class="fas fa-map-marker-alt"></i> Concessionari</a>
        <a th:href="@{/cart}"><i class="fas fa-shopping-cart"></i> Carrello</a>
        <a sec:authorize="!isAuthenticated()" th:href="@{/login}"><i class="fas fa-user"></i> Login</a>
        <a sec:authorize="isAuthenticated()" th:href="@{/account}"><i class="fas fa-user"></i> Account</a>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="dealer-details-section">
    <!-- Dealer Details -->
    <div class="dealer-content">
      <h2 th:text="${dealer.name} ?: 'Concessionario'">Concessionario</h2>
      <div class="main-image-container">
        <img th:if="${dealer.images != null and not dealer.images.isEmpty()}" th:src="@{'/rest/api/images/' + ${dealer.images[0].id}}" th:alt="'Immagine principale concessionario ' + ${dealer.name}"/>
        <img th:unless="${dealer.images != null and not dealer.images.isEmpty()}" src="/image/default-dealer.jpg" alt="Immagine di default"/>
      </div>
      <div class="thumbnails-container">
        <img th:each="image, iterStat : ${dealer.images}" th:if="${iterStat.index > 0}" th:src="@{'/rest/api/images/' + ${image.id}}" th:alt="'Miniatura concessionario ' + ${dealer.name}" onclick="changeMainImage(this)"/>
      </div>
      <p th:if="${errorMessage != null}" th:text="${errorMessage}" class="error-message"></p>
      <div class="description-container">
        <div class="description-item">
          <i class="fas fa-info-circle"></i>
          <span th:text="${dealer.description} ?: 'Nessuna descrizione disponibile'"></span>
        </div>
      </div>
      <div class="details-grid">
        <div class="detail-item">
          <i class="fas fa-map-marker-alt"></i>
          <span th:text="${dealer.address} ?: 'Indirizzo non disponibile'"></span>
        </div>
        <div class="detail-item">
          <i class="fas fa-phone"></i>
          <a th:if="${dealer.phone != null}" th:href="'tel:' + ${dealer.phone}" th:attr="aria-label='Chiama ' + ${dealer.phone}" th:text="${dealer.phone}"></a>
          <span th:unless="${dealer.phone != null}" th:text="'Telefono non disponibile'"></span>
        </div>
        <div class="detail-item">
          <i class="fas fa-envelope"></i>
          <a th:if="${dealer.email != null}" th:href="'mailto:' + ${dealer.email}" th:attr="aria-label='Invia email a ' + ${dealer.email}" th:text="${dealer.email}"></a>
          <span th:unless="${dealer.email != null}" th:text="'Email non disponibile'"></span>
        </div>
      </div>
      <a th:if="${dealer.address != null}" th:href="'https://www.google.com/maps/search/?api=1&query=' + ${#strings.escapeXml(dealer.address)}" class="navigate-button" target="_blank" rel="noopener noreferrer">
        <i class="fas fa-directions"></i> Raggiungi con il navigatore
      </a>
    </div>
    <!-- Cars Section -->
    <div class="cars-section">
      <h2>Auto Disponibili</h2>
      <p th:if="${products == null or products.isEmpty()}" class="no-products">Nessuna auto disponibile al momento.</p>
      <p th:if="${products != null}" th:text="'Auto trovate: ' + ${products.size()}" style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;"></p>
      <div class="car-grid">
        <div th:each="product : ${products}" class="car-card" th:classappend="${product.isFeatured} ? 'highlighted'" th:data-id="${product.id}">
          <div class="car-image">
            <img th:src="@{'/rest/api/images/' + ${product.images[0].id} ?: '/image/default-car.jpg'}" th:alt="'Immagine ' + ${product.model}"/>
            <span th:if="${product.isFeatured}" class="highlight-badge">In Evidenza</span>
          </div>
          <div class="car-info">
            <h4 th:text="${product.brand} + ' ' + ${product.model} ?: 'Modello non disponibile'"></h4>
            <p class="price" th:text="'€ ' + ${#numbers.formatCurrency(product.price)}"></p>
            <p class="details">
              <span th:if="${product.year != null}" th:text="${product.year} + ' | '"></span>
              <span th:if="${product.mileage != null}" th:text="${#numbers.formatInteger(product.mileage, 0, 'COMMA')} + ' km | '"></span>
              <span th:if="${product.fuelType != null}" th:text="${product.fuelType}"></span>
            </p>
          </div>
          <div class="car-actions">
            <a href="#" class="modern-button view-details" th:data-id="${product.id}">
              <i class="fas fa-eye"></i> Dettagli
            </a>
          </div>
        </div>
      </div>
      <!-- Popups per i dettagli delle auto -->
      <div th:each="product : ${products}" class="car-details-popup" th:id="'popup-' + ${product.id}">
        <div class="car-details-popup-content">
          <span class="close-popup">×</span>
          <h3 th:text="${product.brand} + ' ' + ${product.model} ?: 'Auto'"></h3>
          <div class="carousel">
            <div class="carousel-inner">
              <div th:each="image, iterStat : ${product.images}" class="carousel-item" th:classappend="${iterStat.index == 0} ? 'active' : ''">
                <img th:src="@{'/rest/api/images/' + ${image.id}}" th:alt="'Immagine ' + ${product.model}"/>
              </div>
              <div th:if="${product.images == null or product.images.isEmpty()}" class="carousel-item active">
                <img src="/image/default-car.jpg" th:alt="'Immagine ' + ${product.model}"/>
              </div>
            </div>
            <div class="carousel-thumbnails">
              <img th:each="image, iterStat : ${product.images}" th:src="@{'/rest/api/images/' + ${image.id}}" th:alt="'Immagine ' + ${product.model}" th:classappend="${iterStat.index == 0} ? 'active' : ''" onclick="showImage(this, event)"/>
            </div>
            <button class="carousel-control-prev" onclick="prevImage(event)">❮</button>
            <button class="carousel-control-next" onclick="nextImage(event)">❯</button>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-euro-sign"></i> Prezzo</label>
            <p th:text="'€ ' + ${#numbers.formatCurrency(product.price)}"></p>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-calendar-alt"></i> Anno</label>
            <p th:text="${product.year} ?: 'Non specificato'"></p>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-tachometer-alt"></i> Chilometraggio</label>
            <p th:text="${product.mileage != null} ? ${#numbers.formatInteger(product.mileage, 0, 'COMMA')} + ' km' : 'Non specificato'"></p>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-gas-pump"></i> Tipo di carburante</label>
            <p th:text="${product.fuelType} ?: 'Non specificato'"></p>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-cogs"></i> Trasmissione</label>
            <p th:text="${product.transmission} ?: 'Non specificato'"></p>
          </div>
          <div class="detail-field">
            <label><i class="fas fa-info-circle"></i> Descrizione</label>
            <p th:text="${product.description} ?: 'Nessuna descrizione disponibile'"></p>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-content">
    <div class="footer-section">
      <h4>Link Utili</h4>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/products">Trova Auto</a></li>
        <li><a href="/dealers">Concessionari</a></li>
        <li><a href="/cart">Carrello</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Contatti</h4>
      <p>Email: info@fcfmotors.com</p>
      <p>Telefono: +39 123 456 7890</p>
      <p>Indirizzo: Via Auto, 123, Milano, Italia</p>
    </div>
    <div class="footer-section">
      <h4>Seguici</h4>
      <div class="social-links">
        <a href="https://facebook.com" target="_blank" class="social-icon"><i class="fab fa-facebook-f"></i></a>
        <a href="https://instagram.com" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
        <a href="https://twitter.com" target="_blank" class="social-icon"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
    <div class="footer-section">
      <h4>Informazioni</h4>
      <p>FCF Motors offre una vasta gamma di auto nuove e usate. Scopri la tua prossima auto con noi!</p>
    </div>
  </div>
  <div class="footer-bottom">
    <p>© 2025 FCF Motors. Tutti i diritti riservati.</p>
  </div>
</footer>

<script>
  // Gestione del menu a tendina
  document.addEventListener('click', function(event) {
    const dropdownToggle = event.target.closest('.dropdown-toggle');
    const dropdownMenu = document.querySelector('.dropdown-menu');

    if (!dropdownToggle || !dropdownMenu) return;

    if (dropdownToggle) {
      event.stopPropagation();
      const isOpen = dropdownMenu.classList.contains('show');
      dropdownMenu.classList.toggle('show', !isOpen);
      dropdownToggle.classList.toggle('open', !isOpen);
      return;
    }

    if (!dropdownMenu.contains(event.target)) {
      dropdownMenu.classList.remove('show');
      const toggleButton = document.querySelector('.dropdown-toggle');
      if (toggleButton) toggleButton.classList.remove('open');
    }
  });

  document.addEventListener('keydown', function(event) {
    const dropdownToggle = event.target.closest('.dropdown-toggle');
    const dropdownMenu = document.querySelector('.dropdown-menu');

    if (!dropdownToggle || !dropdownMenu) return;

    if ((event.key === 'Enter' || event.key === ' ') && event.target === dropdownToggle) {
      event.preventDefault();
      const isOpen = dropdownMenu.classList.contains('show');
      dropdownMenu.classList.toggle('show', !isOpen);
      dropdownToggle.classList.toggle('open', !isOpen);
    }
  });

  // Funzione per cambiare l'immagine principale
  function changeMainImage(thumbnail) {
    const mainImage = document.querySelector('.main-image-container img');
    mainImage.src = thumbnail.src;
    mainImage.alt = thumbnail.alt;
  }

  // Gestione del popup
  document.addEventListener('click', function(event) {
    const viewDetailsButton = event.target.closest('.view-details');
    const closePopup = event.target.closest('.close-popup');
    const popups = document.querySelectorAll('.car-details-popup');

    if (viewDetailsButton) {
      event.preventDefault();
      const productId = viewDetailsButton.getAttribute('data-id');
      const popup = document.getElementById(`popup-${productId}`);
      if (popup) {
        popups.forEach(p => p.classList.remove('show'));
        popup.classList.add('show');
        initializeCarousel(popup);
      } else {
        console.error(`Popup with ID popup-${productId} not found`);
      }
    }

    if (closePopup) {
      popups.forEach(p => p.classList.remove('show'));
    } else {
      popups.forEach(popup => {
        if (event.target === popup && !popup.querySelector('.car-details-popup-content').contains(event.target)) {
          popup.classList.remove('show');
        }
      });
    }
  });

  // Chiusura del popup con il tasto Esc
  document.addEventListener('keydown', function(event) {
    const popups = document.querySelectorAll('.car-details-popup');
    if (event.key === 'Escape') {
      popups.forEach(p => p.classList.remove('show'));
    }
  });

  // Funzione per inizializzare il carosello in ogni popup
  function initializeCarousel(popup) {
    const carousel = popup.querySelector('.carousel');
    if (!carousel) return;

    let currentIndex = 0;
    const items = carousel.querySelectorAll('.carousel-item');
    const thumbnails = carousel.querySelectorAll('.carousel-thumbnails img');
    const prevBtn = carousel.querySelector('.carousel-control-prev');
    const nextBtn = carousel.querySelector('.carousel-control-next');

    if (items.length <= 1 || !prevBtn || !nextBtn) {
      if (prevBtn) prevBtn.style.display = 'none';
      if (nextBtn) nextBtn.style.display = 'none';
      return;
    }

    const updateCarousel = () => {
      items.forEach((item, index) => {
        item.classList.toggle('active', index === currentIndex);
      });
      thumbnails.forEach((thumb, index) => {
        thumb.classList.toggle('active', index === currentIndex);
      });
    };

    prevBtn.addEventListener('click', (event) => {
      event.stopPropagation();
      currentIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
      updateCarousel();
    });

    nextBtn.addEventListener('click', (event) => {
      event.stopPropagation();
      currentIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;
      updateCarousel();
    });

    thumbnails.forEach((thumb, index) => {
      thumb.addEventListener('click', (event) => {
        event.stopPropagation();
        currentIndex = index;
        updateCarousel();
      });
    });

    updateCarousel();
  }

  // Inizializza i caroselli per ogni popup all'avvio
  document.querySelectorAll('.car-details-popup').forEach(popup => {
    initializeCarousel(popup);
  });
</script>
</body>
</html>