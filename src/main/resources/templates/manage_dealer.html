<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Gestione Concessionario</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        /* Highlighted product styling */
        .product-card.highlighted {
            border: 2px solid #ffd700;
            background-color: #fffde7;
        }
        .highlight-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ffd700;
            color: #333;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .invalid {
            border-color: red !important;
            animation: shake 0.3s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .spinner {
            display: none;
            margin-left: 5px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner.active {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #FFFFFF;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.error {
            background-color: #dc3545;
        }
        .animated-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
        }
        .animated-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .product-card {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.3s, transform 0.3s;
        }
        .product-card.visible {
            opacity: 1;
            transform: scale(1);
        }
    </style>
</head>
<body>
<header class="header-transparent">
    <div class="header-left">
        <a href="/" class="logo-link">
            <div class="logo-container">
                <img src="/image/logo1.png" alt="Logo" class="logo">
            </div>
        </a>
        <div class="title-container">
            <h2 class="main-title">FCF MOTORS</h2>
            <a th:href="@{/products}" class="products-button">
                <i class="fas fa-car"></i> Prodotti
            </a>
            <a th:href="@{/dealers}" class="dealers-button">
                <i class="fas fa-store"></i> Concessionari
            </a>
        </div>
    </div>
    <div class="nav-container">
        <nav class="nav-bar">
            <a th:href="@{/cart}" class="icon-button">
                <i class="fas fa-shopping-cart"></i>
            </a>
            <a th:href="@{/account}" class="icon-button">
                <i class="fas fa-user"></i>
            </a>
        </nav>
    </div>
</header>

<main>
    <div class="two-column-container shared-background">
        <!-- Colonna Dettagli Concessionario -->
        <div class="dealer-details-column">
            <div class="hero-content">
                <h2>Gestione Concessionario</h2>
                <div id="display-dealer-details" class="animated-section visible">
                    <div class="input-field display-field">
                        <label for="display-name"><i class="fas fa-store"></i> Nome Concessionario</label>
                        <span id="display-name" th:text="${dealer.name}"></span>
                    </div>
                    <div class="input-field display-field">
                        <label for="display-description"><i class="fas fa-file-alt"></i> Descrizione</label>
                        <span id="display-description" th:text="${dealer.description} ?: ''"></span>
                    </div>
                    <div class="input-field display-field">
                        <label for="display-address"><i class="fas fa-map-marker-alt"></i> Indirizzo</label>
                        <span id="display-address" th:text="${dealer.address} ?: ''"></span>
                    </div>
                    <div class="input-field display-field">
                        <label for="display-contact"><i class="fas fa-phone"></i> Contatti</label>
                        <span id="display-contact" th:text="${dealer.contact} ?: ''"></span>
                    </div>
                    <div class="input-field display-field">
                        <label for="dealer-image"><i class="fas fa-image"></i> Immagine Concessionario</label>
                        <img id="dealer-image" class="dealer-image" th:src="${dealer.imagePath} ?: 'https://via.placeholder.com/300x200?text=Immagine+Non+Disponibile'" alt="Immagine Concessionario">
                    </div>
                    <div class="form-actions">
                        <a href="#" id="edit-dealer-button" class="modern-button"><i class="fas fa-edit"></i> Modifica</a>
                        <a th:href="@{'/rest/dealer/quote-requests/' + ${dealer.id}}" class="modern-button"><i class="fas fa-envelope"></i> Visualizza Richieste di Preventivo</a>
                        <a th:if="${dealer != null and dealer.id != null}" th:href="@{/rest/manutenzione/dealer/delete_dealer/{id}(id=${dealer.id})}" th:id="'delete-dealer-link-' + ${dealer.id}" class="modern-button cancel-button"><i class="fas fa-trash"></i> Elimina</a>
                        <a th:unless="${dealer != null and dealer.id != null}" href="#" class="modern-button cancel-button disabled" onclick="alert('Impossibile eliminare: concessionario non valido'); return false;"><i class="fas fa-trash"></i> Elimina</a>
                    </div>
                </div>
                <form id="dealership-form" class="modern-form" style="display: none;" aria-labelledby="dealership-form-title" th:action="@{/rest/api/dealers}" method="post">
                    <h2 id="dealership-form-title">Modifica Concessionario</h2>
                    <input type="hidden" name="id" th:value="${dealer.id}">
                    <div class="input-field">
                        <label for="edit-dealership-name"><i class="fas fa-store"></i> Nome Concessionario</label>
                        <input type="text" id="edit-dealership-name" name="name" th:value="${dealer.name}" required aria-required="true">
                    </div>
                    <div class="input-field">
                        <label for="edit-dealership-description"><i class="fas fa-file-alt"></i> Descrizione</label>
                        <textarea id="edit-dealership-description" name="description" rows="4" th:text="${dealer.description}"></textarea>
                    </div>
                    <div class="input-field">
                        <label for="edit-dealership-address"><i class="fas fa-map-marker-alt"></i> Indirizzo</label>
                        <input type="text" id="edit-dealership-address" name="address" th:value="${dealer.address}">
                    </div>
                    <div class="input-field">
                        <label for="edit-dealership-contact"><i class="fas fa-phone"></i> Contatti</label>
                        <input type="text" id="edit-dealership-contact" name="contact" th:value="${dealer.contact}">
                    </div>
                    <div class="input-field">
                        <label for="edit-dealership-imagePath"><i class="fas fa-image"></i> URL Immagine</label>
                        <input type="url" id="edit-dealership-imagePath" name="imagePath" th:value="${dealer.imagePath}">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="modern-button"><i class="fas fa-save"></i> Salva <span class="spinner"></span></button>
                        <button type="button" id="cancel-edit-dealer" class="modern-button cancel-button"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Colonna Aggiungi una Macchina -->
        <div class="add-car-column">
            <div class="hero-content">
                <h2>Aggiungi una Macchina</h2>
                <form id="dealer-add-car-form" class="modern-form" th:action="@{/rest/api/products}" method="post" aria-labelledby="add-car-form-title">
                    <input type="hidden" name="dealerId" th:value="${dealer.id}">
                    <h2 id="add-car-form-title" style="display: none;">Aggiungi Auto</h2>
                    <div class="input-field">
                        <label for="dealer-car-name"><i class="fas fa-car"></i> Nome Macchina</label>
                        <input type="text" id="dealer-car-name" name="name" required aria-required="true">
                    </div>
                    <div class="input-field">
                        <label for="dealer-car-description"><i class="fas fa-file-alt"></i> Descrizione</label>
                        <textarea id="dealer-car-description" name="description" rows="4"></textarea>
                    </div>
                    <div class="input-field">
                        <label for="dealer-car-price"><i class="fas fa-euro-sign"></i> Prezzo (€)</label>
                        <input type="number" id="dealer-car-price" name="price" required step="0.01" min="0.01" aria-required="true">
                    </div>
                    <div class="input-field">
                        <label for="dealer-car-imageUrl"><i class="fas fa-image"></i> URL Immagine</label>
                        <input type="url" id="dealer-car-imageUrl" name="imageUrl">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="modern-button"><i class="fas fa-plus"></i> Aggiungi <span class="spinner"></span></button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Sezione Macchine Aggiunte -->
    <section id="dealer-added-cars" class="products-section animated-section">
        <h3>Macchine Aggiunte</h3>
        <div class="product-grid">
            <div th:each="product : ${products}" th:classappend="${product.isFeatured and product.isFeaturedActive} ? 'product-card animated-card highlighted' : 'product-card animated-card'">
                <div class="product-image">
                    <img th:src="${product.imageUrl} ?: 'https://via.placeholder.com/300x200?text=Auto+Immagine'" alt="Immagine Auto">
                    <span class="product-badge"><i class="fas fa-car"></i></span>
                    <span th:if="${product.isFeatured and product.isFeaturedActive}" class="highlight-badge">In Evidenza</span>
                </div>
                <div class="product-info">
                    <div class="info-row">
                        <span class="label"><strong>Nome:</strong></span>
                        <span class="value" th:text="${product.name}"></span>
                    </div>
                    <div class="info-row">
                        <span class="label"><strong>Descrizione:</strong></span>
                        <span class="value" th:text="${product.description} ?: ''"></span>
                    </div>
                    <div class="info-row">
                        <span class="label"><strong>Prezzo:</strong></span>
                        <span class="value" th:text="${product.price} + ' €'"></span>
                    </div>
                    <div class="info-row">
                        <span class="label"><strong>In Evidenza:</strong></span>
                        <span class="value" th:text="${product.isFeatured and product.isFeaturedActive} ? 'Sì' : 'No'"></span>
                    </div>
                    <div class="info-row" th:if="${product.isFeatured and product.isFeaturedActive}">
                        <span class="label"><strong>Scadenza Evidenza:</strong></span>
                        <span class="value" th:text="${product.featuredUntil} ?: '-'"></span>
                    </div>
                    <div class="form-actions">
                        <a href="#" th:attr="data-product-id=${product.id}" class="modern-button edit-product-link"><i class="fas fa-edit"></i> Modifica</a>
                        <a href="#" th:attr="data-product-id=${product.id}" class="modern-button delete-product-link cancel-button"><i class="fas fa-trash"></i> Elimina</a>
                        <a href="#" th:attr="data-product-id=${product.id}" class="modern-button highlight-product-link" th:if="${!product.isFeatured or !product.isFeaturedActive}"><i class="fas fa-star"></i> Metti in Evidenza</a>
                        <a href="#" th:attr="data-product-id=${product.id}" class="modern-button remove-highlight-product-link cancel-button" th:if="${product.isFeatured and product.isFeaturedActive}"><i class="fas fa-star"></i> Rimuovi Evidenza</a>
                    </div>
                </div>
            </div>
        </div>
        <div th:if="${products.isEmpty()}" class="no-products">
            <i class="fas fa-car no-products-icon"></i>
            Nessuna macchina aggiunta
        </div>
        <div class="form-actions">
            <a th:href="@{/dealers}" class="modern-button back-button"><i class="fas fa-arrow-left"></i> Torna ai concessionari</a>
        </div>
    </section>

    <!-- Form per la modifica del prodotto -->
    <div class="hero-content" style="display: none;">
        <form id="edit-product-form" class="modern-form" style="display: none;" aria-labelledby="edit-product-form-title">
            <h2 id="edit-product-form-title">Modifica Auto</h2>
            <input type="hidden" id="edit-product-id">
            <div class="input-field">
                <label for="edit-product-name"><i class="fas fa-car"></i> Nome Macchina</label>
                <input type="text" id="edit-product-name" required aria-required="true">
            </div>
            <div class="input-field">
                <label for="edit-product-description"><i class="fas fa-file-alt"></i> Descrizione</label>
                <textarea id="edit-product-description" rows="4"></textarea>
            </div>
            <div class="input-field">
                <label for="edit-product-price"><i class="fas fa-euro-sign"></i> Prezzo (€)</label>
                <input type="number" id="edit-product-price" required step="0.01" min="0.01" aria-required="true">
            </div>
            <div class="input-field">
                <label for="edit-product-imageUrl"><i class="fas fa-image"></i> URL Immagine</label>
                <input type="url" id="edit-product-imageUrl">
            </div>
            <div class="input-field">
                <label for="edit-product-highlighted"><i class="fas fa-star"></i> Metti in Evidenza</label>
                <input type="checkbox" id="edit-product-highlighted" name="highlighted">
            </div>
            <div class="input-field" id="edit-highlight-duration-field" style="display: none;">
                <label for="edit-product-highlight-duration"><i class="fas fa-clock"></i> Durata Evidenza (giorni)</label>
                <input type="number" id="edit-product-highlight-duration" name="highlightDuration" min="1" step="1">
            </div>
            <div class="form-actions">
                <button type="submit" class="modern-button"><i class="fas fa-save"></i> Salva <span class="spinner"></span></button>
                <button type="button" id="cancel-edit-product" class="modern-button cancel-button"><i class="fas fa-times"></i> Annulla</button>
            </div>
        </form>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" role="alert" aria-live="assertive"></div>
</main>

<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>Link Utili</h4>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/products">Trova Auto</a></li>
                <li><a href="/dealers">Concessionari</a></li>
                <li><a href="/cart">Carrello</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Contatti</h4>
            <p>Email: info@fcfmotors.com</p>
            <p>Telefono: +39 123 456 7890</p>
            <p>Indirizzo: Via Auto, 123, Milano, Italia</p>
        </div>
        <div class="footer-section">
            <h4>Seguici</h4>
            <div class="social-links">
                <a href="https://facebook.com" target="_blank" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                <a href="https://instagram.com" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="https://twitter.com" target="_blank" class="social-icon"><i class="fab fa-twitter"></i></a>
            </div>
        </div>
        <div class="footer-section">
            <h4>Informazioni</h4>
            <p>FCF Motors offre una vasta gamma di auto nuove e usate. Scopri la tua prossima auto con noi!</p>
        </div>
    </div>
    <div class="footer-bottom">
        <p>© 2025 FCF Motors. Tutti i diritti riservati.</p>
    </div>
</footer>

<script th:src="@{/js/dealer_manage.js}"></script>
</body>
</html>