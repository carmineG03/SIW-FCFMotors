<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Aggiungi Auto - FCF Motors</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/allert.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bungee+Spice&display=swap">

    <style>
      
        body {
            background: linear-gradient(135deg, #010A33, #003087);
            color: #FFFFFF;
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Main content */
        .main-content {
            padding: 40px 20px;
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 100px;
            margin-bottom: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-family: 'Bungee Spice', cursive;
            color: #F5A623;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #F5A623;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(245, 166, 35, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #F5A623;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group select {
            cursor: pointer;
        }

        .form-group select option {
            background: #333;
            color: white;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-single {
            grid-column: 1 / -1;
        }

        .file-upload {
            border: 2px dashed #F5A623;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: rgba(245, 166, 35, 0.1);
            transition: background 0.3s ease;
        }

        .file-upload:hover {
            background: rgba(245, 166, 35, 0.2);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            display: block;
            cursor: pointer;
            color: #F5A623;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(45deg, #F5A623, #E59400);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: block;
            margin: 30px auto 0;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-link {
            display: inline-block;
            color: #F5A623;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }
        .social-links {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #F5A623, #E59400);
            color: white;
            border-radius: 50%;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        .social-icon:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .dropdown-menu {
                min-width: 180px;
            }
            .dropdown-toggle {
                width: 36px;
                height: 36px;
            }
            .dropdown-toggle i {
                font-size: 1rem;
            }
            .dropdown-menu {
                top: 40px;
            }
            .dropdown-menu a {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            .header-right {
                right: 10px;
                gap: 5px;
            }
        }
    </style>
</head>

<body>
<header>
    <div class="header-left">
        <a href="/" class="logo-link">
            <div class="logo-container">
                <img src="/image/logo1.png" alt="Logo" class="logo">
            </div>
            <div class="title-container">
                <h1 class="main-title">FCF MOTORS</h1>
            </div>
        </a>
    </div>
    <div class="header-right">
        <div class="dropdown">
            <button class="dropdown-toggle" aria-label="Menu" onclick="toggleDropdownMenu(event)">
                <i class="fas fa-bars"></i>
            </button>
            <div class="dropdown-menu">
                <a th:href="@{/products}"><i class="fas fa-car"></i> Trova Auto</a>
                <a th:href="@{/dealers}"><i class="fas fa-map-marker-alt"></i> Concessionari</a>
                <a th:href="@{/cart}" class="cart-item">
                    <i class="fas fa-shopping-cart"></i> Carrello
                </a>
                <a th:href="@{/account}"><i class="fas fa-user"></i> Account</a>
            </div>
        </div>
    </div>
</header>

<div class="main-content">
    
    <div class="page-header">
        <h1>Aggiungi la Tua Auto</h1>
        <p>Compila tutti i campi per aggiungere la tua auto al sistema</p>
    </div>

    <!-- Messaggi di feedback -->
    <div th:if="${param.error}" class="alert alert-danger">
    <strong>Errore:</strong>
    <span th:switch="${param.error}">
        <span th:case="'already_has_car'">Hai già una macchina associata!</span>
        <span th:case="'no_images'">Devi caricare almeno un'immagine!</span>
        <span th:case="'missing_brand'">La marca è obbligatoria!</span>
        <span th:case="'missing_model'">Il modello è obbligatorio!</span>
        <span th:case="'missing_category'">La categoria è obbligatoria!</span>
        <span th:case="'missing_fuel_type'">Il tipo di carburante è obbligatorio!</span>
        <span th:case="'missing_transmission'">La trasmissione è obbligatoria!</span>
        <span th:case="'missing_description'">La descrizione è obbligatoria!</span>
        <span th:case="'invalid_price'">Il prezzo deve essere maggiore di 0!</span>
        <span th:case="'invalid_year'">Anno non valido!</span>
        <span th:case="'invalid_mileage'">Chilometraggio non valido!</span>
        <span th:case="'no_valid_images'">Nessuna immagine valida processata!</span>
        <span th:case="'add_failed'">Impossibile aggiungere l'auto!</span>
        <span th:case="*">Si è verificato un errore!</span>
    </span>
</div>



    <form th:action="@{/private/add}" method="post" enctype="multipart/form-data" id="carForm">
        <!-- CSRF Token -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <!-- Informazioni base -->
        <div class="form-row">
            <div class="form-group">
                <label for="brand">Marca *</label>
                <input type="text" id="brand" name="brand" required maxlength="50">
            </div>
            <div class="form-group">
                <label for="model">Modello *</label>
                <input type="text" id="model" name="model" required maxlength="50">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="category">Categoria *</label>
                <select id="category" name="category" required>
                    <option value="">Seleziona categoria</option>
                    <option value="SUV">SUV</option>
                    <option value="Sedan">Berlina</option>
                    <option value="Sportiva">Sportiva</option>
                    <option value="Hatchback">City Car</option>
                    <option value="Station Wagon">Station Wagon</option>
                    <option value="Coupe">Elettrica</option>
                </select>
            </div>
            <div class="form-group">
                <label for="price">Prezzo (€) *</label>
                <input type="number" id="price" name="price" required min="1" max="999999" step="0.01">
            </div>
        </div>

        <!-- Dettagli tecnici -->
        <div class="form-row">
            <div class="form-group">
                <label for="year">Anno *</label>
                <input type="number" id="year" name="year" required min="1900" max="2030">
            </div>
            <div class="form-group">
                <label for="mileage">Chilometraggio *</label>
                <input type="number" id="mileage" name="mileage" required min="0" max="9999999">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="fuelType">Carburante *</label>
                <select id="fuelType" name="fuelType" required>
                    <option value="">Seleziona carburante</option>
                    <option value="Benzina">Benzina</option>
                    <option value="Diesel">Diesel</option>
                    <option value="Elettrico">Elettrico</option>
                    <option value="Ibrido">Ibrido</option>
                    <option value="GPL">GPL</option>
                    <option value="Metano">Metano</option>
                </select>
            </div>
            <div class="form-group">
                <label for="transmission">Trasmissione *</label>
                <select id="transmission" name="transmission" required>
                    <option value="">Seleziona trasmissione</option>
                    <option value="Manuale">Manuale</option>
                    <option value="Automatico">Automatico</option>
                </select>
            </div>
        </div>

        <!-- Descrizione -->
        <div class="form-group form-row-single">
            <label for="description">Descrizione *</label>
            <textarea id="description" name="description" required maxlength="2000" 
                      placeholder="Descrivi la tua auto, le sue condizioni, optional extra, ecc..."></textarea>
        </div>

        <!-- Upload immagini -->
        <div class="form-group form-row-single">
            <label>Immagini Auto * (min 1, max 10)</label>
            <div class="file-upload">
                <input type="file" id="images" name="images" multiple accept="image/*" required>
                <label for="images">
                    <i class="fas fa-cloud-upload-alt"></i><br>
                    Clicca per selezionare le immagini<br>
                    <small>Formati supportati: JPG, PNG, GIF (max 5MB ciascuna)</small>
                </label>
            </div>
            <div id="preview-container" class="preview-container"></div>
        </div>

        <button type="submit" class="btn" id="submitBtn">
            <i class="fas fa-plus"></i> Aggiungi Auto
        </button>
    </form>
</div>

<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>FCF Motors</h4>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/products">Auto in Vendita</a></li>
                <li><a href="/dealers">Concessionari</a></li>
                <li><a href="/about">Chi Siamo</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Servizi</h4>
            <ul>
                <li><a href="/services">Finanziamenti</a></li>
                <li><a href="/services">Assicurazioni</a></li>
                <li><a href="/services">Garanzie</a></li>
                <li><a href="/services">Assistenza</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Supporto</h4>
            <ul>
                <li><a href="/contact">Contattaci</a></li>
                <li><a href="/help">Centro Aiuto</a></li>
                <li><a href="/privacy">Privacy Policy</a></li>
                <li><a href="/terms">Termini di Servizio</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Seguici</h4>
            <div class="social-links">
                <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2024 FCF Motors. Tutti i diritti riservati.</p>
    </div>
</footer>

<script>
// Toggle dropdown menu
function toggleDropdownMenu(event) {
    event.stopPropagation();
    const dropdown = event.target.closest('.dropdown');
    const menu = dropdown.querySelector('.dropdown-menu');
    const toggle = dropdown.querySelector('.dropdown-toggle');
    
    menu.classList.toggle('show');
    toggle.classList.toggle('open');
}

// Close dropdown when clicking outside
document.addEventListener('click', function() {
    const dropdowns = document.querySelectorAll('.dropdown-menu');
    const toggles = document.querySelectorAll('.dropdown-toggle');
    
    dropdowns.forEach(dropdown => dropdown.classList.remove('show'));
    toggles.forEach(toggle => toggle.classList.remove('open'));
});

// Image preview functionality
document.getElementById('images').addEventListener('change', function(e) {
    const previewContainer = document.getElementById('preview-container');
    const files = Array.from(e.target.files);
    
    previewContainer.innerHTML = '';
    
    if (files.length > 10) {
        alert('Puoi caricare massimo 10 immagini');
        e.target.value = '';
        return;
    }
    
    files.forEach((file, index) => {
        if (file.size > 5 * 1024 * 1024) {
            alert(`L'immagine ${file.name} è troppo grande (max 5MB)`);
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.innerHTML = `
                <img src="${e.target.result}" alt="Preview ${index + 1}">
                <button type="button" class="remove-btn" onclick="removeImage(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            previewContainer.appendChild(previewItem);
        };
        reader.readAsDataURL(file);
    });
});

function removeImage(index) {
    const fileInput = document.getElementById('images');
    const dt = new DataTransfer();
    const files = Array.from(fileInput.files);
    
    files.forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    
    fileInput.files = dt.files;
    fileInput.dispatchEvent(new Event('change'));
}

// Form validation
document.getElementById('carForm').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submitBtn');
    const files = document.getElementById('images').files;
    
    if (files.length === 0) {
        alert('Devi caricare almeno un\'immagine');
        e.preventDefault();
        return;
    }
    
    if (files.length > 10) {
        alert('Puoi caricare massimo 10 immagini');
        e.preventDefault();
        return;
    }
    
    // Check file sizes
    for (let file of files) {
        if (file.size > 5 * 1024 * 1024) {
            alert('Tutte le immagini devono essere inferiori a 5MB');
            e.preventDefault();
            return;
        }
    }
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Caricamento...';
});

// Auto-trim form fields
['brand', 'model', 'description'].forEach(fieldName => {
    const field = document.getElementById(fieldName);
    if (field) {
        field.addEventListener('blur', function() {
            this.value = this.value.trim();
        });
    }
});
</script>
</body>
</html>