<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifica Macchina</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- CSS locale -->
    <link th:href="@{/css/styles.css}" href="/css/styles.css" rel="stylesheet">
</head>
<body>
<header id="main-header">
    <div class="header-left">
        <a href="/" class="logo-link">
            <div class="logo-container">
                <img th:src="@{/image/logo1.png}" alt="FCF Motors Logo" class="logo"/>
            </div>
        </a>
        <div class="title-container">
            <h1 class="main-title">FCF MOTORS</h1>
            <a href="/products" class="products-button"><i class="fas fa-car"></i> Trova Auto</a>
            <a href="/dealers" class="dealers-button"><i class="fas fa-map-marker-alt"></i> Concessionari</a>
        </div>
    </div>
    <div class="nav-container">
        <div class="nav-bar">
            <a th:if="${isAuthenticated != null and !isAuthenticated}" href="/login" class="icon-button"><i class="fas fa-user"></i> Login</a>
            <a th:if="${isAuthenticated != null and isAuthenticated}" href="/account" class="icon-button"><i class="fas fa-user"></i> <span th:text="${user != null ? user.username : 'Account'}"></span></a>
            <a href="/cart" class="icon-button"><i class="fas fa-shopping-cart"></i> Carrello</a>

        </div>
    </div>
</header>

<section class="hero-section private-edit-hero">
    <div class="hero-content">
        <h2>Dettagli Macchina</h2>

        <!-- Sezione dettagli -->
        <div id="car-details" class="car-details">
            <div class="detail-field">
                <label><i class="fas fa-car"></i> Macchina</label>
                <p th:text="${product != null ? product.brand + ' ' + product.model : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-align-left"></i> Descrizione</label>
                <p th:text="${product != null ? product.description : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-euro-sign"></i> Prezzo (€)</label>
                <p th:text="${product != null ? product.price : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-tags"></i> Categoria</label>
                <p th:text="${product != null ? product.category : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-industry"></i> Marca</label>
                <p th:text="${product != null ? product.brand : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-car-side"></i> Modello</label>
                <p th:text="${product != null ? product.model : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-tachometer-alt"></i> Chilometraggio</label>
                <p th:text="${product != null ? product.mileage : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-calendar-alt"></i> Anno</label>
                <p th:text="${product != null ? product.year : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-gas-pump"></i> Tipo di carburante</label>
                <p th:text="${product != null ? product.fuelType : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-cogs"></i> Trasmissione</label>
                <p th:text="${product != null ? product.transmission : 'N/A'}"></p>
            </div>
            <div class="detail-field">
                <label><i class="fas fa-image"></i> Immagine</label>
                <img th:src="${product != null and product.imageUrl != null ? product.imageUrl : '/image/default-car.jpg'}" alt="Immagine Macchina" class="car-image">
            </div>
            <div class="button-group">
                <button id="edit-button" class="modern-button"><i class="fas fa-edit"></i> Modifica</button>

                <form th:action="@{/private/delete/{id}(id=${product.id})}" method="post" style="display: inline;">
                    <button type="submit" class="modern-button danger" onclick="return confirm('Sei sicuro di voler eliminare questa macchina?');"><i class="fas fa-trash"></i> Elimina</button>
                </form>
            </div>
        </div>

        <!-- Form di modifica (nascosto inizialmente) -->
        <form th:action="@{/private/edit/{id}(id=${product.id})}" th:object="${product}" method="post" class="modern-form" id="edit-car-form" style="display: none;">
            <div class="input-field">
                <label for="brand"><i class="fas fa-industry"></i> Marca</label>
                <input type="text" id="brand" th:field="*{brand}" th:value="*{brand}" placeholder="Marca" required>
                <span th:if="${#fields.hasErrors('brand')}" th:errors="*{brand}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="model"><i class="fas fa-car-side"></i> Modello</label>
                <input type="text" id="model" th:field="*{model}" th:value="*{model}" placeholder="Modello" required>
                <span th:if="${#fields.hasErrors('model')}" th:errors="*{model}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="description"><i class="fas fa-align-left"></i> Descrizione</label>
                <textarea id="description" th:field="*{description}" th:value="*{description}" placeholder="Descrizione" required></textarea>
                <span th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="price"><i class="fas fa-euro-sign"></i> Prezzo (€)</label>
                <input type="number" id="price" th:field="*{price}" th:value="*{price}" placeholder="Prezzo (€)" step="0.01" required>
                <span th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="category"><i class="fas fa-tags"></i> Categoria</label>
                <input type="text" id="category" th:field="*{category}" th:value="*{category}" placeholder="Categoria" required>
                <span th:if="${#fields.hasErrors('category')}" th:errors="*{category}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="mileage"><i class="fas fa-tachometer-alt"></i> Chilometraggio</label>
                <input type="number" id="mileage" th:field="*{mileage}" th:value="*{mileage}" placeholder="Chilometraggio" required>
                <span th:if="${#fields.hasErrors('mileage')}" th:errors="*{mileage}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="year"><i class="fas fa-calendar-alt"></i> Anno</label>
                <input type="number" id="year" th:field="*{year}" th:value="*{year}" placeholder="Anno" required>
                <span th:if="${#fields.hasErrors('year')}" th:errors="*{year}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="fuelType"><i class="fas fa-gas-pump"></i> Tipo di carburante</label>
                <input type="text" id="fuelType" th:field="*{fuelType}" th:value="*{fuelType}" placeholder="Tipo di carburante" required>
                <span th:if="${#fields.hasErrors('fuelType')}" th:errors="*{fuelType}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="transmission"><i class="fas fa-cogs"></i> Trasmissione</label>
                <input type="text" id="transmission" th:field="*{transmission}" th:value="*{transmission}" placeholder="Trasmissione" required>
                <span th:if="${#fields.hasErrors('transmission')}" th:errors="*{transmission}" class="error"></span>
            </div>
            <div class="input-field">
                <label for="imageUrl"><i class="fas fa-image"></i> URL Immagine</label>
                <input type="text" id="imageUrl" th:field="*{imageUrl}" th:value="*{imageUrl}" placeholder="https://example.com/image.jpg" required>
                <span th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}" class="error"></span>
            </div>
            <div class="button-group">
                <button type="submit" class="modern-button"><i class="fas fa-save"></i> Salva Modifiche</button>
                <button type="button" id="cancel-button" class="modern-button secondary"><i class="fas fa-times"></i> Annulla</button>
            </div>
        </form>

        <!-- Messaggi di feedback -->
        <div th:if="${param.error}">
            <p class="error-message" th:text="${param.error == 'not_authorized'} ? 'Errore: Non autorizzato!' : 'Errore generico!'"></p>
        </div>
        <div th:if="${param.success}">
            <p style="color: green;">Macchina modificata con successo!</p>
        </div>
    </div>
</section>

<div class="toast" id="toast"></div>
<script th:src="@{/js/maintenance_private.js}" src="/js/maintenance_private.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const detailsSection = document.getElementById('car-details');
        const editForm = document.getElementById('edit-car-form');
        const editButton = document.getElementById('edit-button');
        const cancelButton = document.getElementById('cancel-button');

        editButton.addEventListener('click', function() {
            detailsSection.style.display = 'none';
            editForm.style.display = 'block';
        });

        cancelButton.addEventListener('click', function() {
            editForm.style.display = 'none';
            detailsSection.style.display = 'block';
        });
    });
</script>
</body>
</html>